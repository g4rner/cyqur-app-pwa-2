const buff_to_base64=e=>btoa(String.fromCharCode.apply(null,e)),base64_to_buf=e=>Uint8Array.from(atob(e),(e=>e.charCodeAt(null))),enc=new TextEncoder,dec=new TextDecoder,deriveKey=(e,t,n)=>window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:25e4,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,n),getPasswordKey=e=>window.crypto.subtle.importKey("raw",enc.encode(e),"PBKDF2",!1,["deriveKey"]),decryptData=async(e,t)=>{try{const a=(n=e,Uint8Array.from(atob(n),(e=>e.charCodeAt(null))));return salt=a.slice(0,16),iv=a.slice(16,28),data=a.slice(28),passwordKey=await getPasswordKey(t),aesKey=await deriveKey(passwordKey,salt,["decrypt"]),decryptedContent=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:iv},aesKey,data),dec.decode(decryptedContent)}catch(e){return""}var n},decrypt=async()=>{const e=window.document.getElementById("ipwd").value,t=window.document.getElementById("pastedin").value;let n=window.document.getElementById("dedata");const a=await decryptData(t,e);n.value=a||"",parseTheResponse(a||"")},encrypt=async()=>{let e=window.document.getElementById("ddata").value,t=document.getElementById("tags").value;e=btoa(encodeURIComponent(e));const n=sha256(encodeURIComponent(e)+timestampa);e='{"secret":"'+e+'","tags":"'+t+'","puk":"'+n+'","meta":"'+timestampa+'","encoding":"base64 AES-GCM"}',document.getElementById("dhead").innerHTML=n;let a=window.document.getElementById("edata");const r=document.getElementById("thepwd2");let o;return o=null!==r&&""!==r.value?window.document.getElementById("thepwd2").value:window.document.getElementById("thepwd").value,encryptedData=await encryptData(e,o),a.value=encryptedData,setSplitInputs(encryptedData),{encryptedData:encryptedData,puk:n}},rightRotate=(e,t)=>e>>>t|e<<32-t,sha256=e=>{for(var t,n,a=Math.pow,r=a(2,32),o="",d=[],c=8*e.length,y=sha256.h=sha256.h||[],s=sha256.k=sha256.k||[],i=s.length,l={},w=2;i<64;w++)if(!l[w]){for(t=0;t<313;t+=w)l[t]=w;y[i]=a(w,.5)*r|0,s[i++]=a(w,1/3)*r|0}for(e+="Â€";e.length%64-56;)e+="\0";for(t=0;t<e.length;t++){if((n=e.charCodeAt(t))>>8)return;d[t>>2]|=n<<(3-t)%4*8}for(d[d.length]=c/r|0,d[d.length]=c,n=0;n<d.length;){var h=d.slice(n,n+=16),p=y;for(y=y.slice(0,8),t=0;t<64;t++){var g=h[t-15],u=h[t-2],m=y[0],v=y[4],b=y[7]+(rightRotate(v,6)^rightRotate(v,11)^rightRotate(v,25))+(v&y[5]^~v&y[6])+s[t]+(h[t]=t<16?h[t]:h[t-16]+(rightRotate(g,7)^rightRotate(g,18)^g>>>3)+h[t-7]+(rightRotate(u,17)^rightRotate(u,19)^u>>>10)|0);(y=[b+((rightRotate(m,2)^rightRotate(m,13)^rightRotate(m,22))+(m&y[1]^m&y[2]^y[1]&y[2]))|0].concat(y))[4]=y[4]+b|0}for(t=0;t<8;t++)y[t]=y[t]+p[t]|0}for(t=0;t<8;t++)for(n=3;n+1;n--){var f=y[t]>>8*n&255;o+=(f<16?0:"")+f.toString(16)}return o},encryptData=async(e,t)=>{try{const n=window.crypto.getRandomValues(new Uint8Array(16)),a=window.crypto.getRandomValues(new Uint8Array(12)),r=await getPasswordKey(t),o=await deriveKey(r,n,["encrypt"]);encryptedContent=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},o,enc.encode(e)),encryptedContentArr=new Uint8Array(encryptedContent);let d=new Uint8Array(n.byteLength+a.byteLength+encryptedContentArr.byteLength);d.set(n,0),d.set(a,n.byteLength),d.set(encryptedContentArr,n.byteLength+a.byteLength);return buff_to_base64(d)}catch(e){return""}},checkPassword=async()=>{const e=document.getElementById("thepwd").value;let t;return await getItem(1,USER_INFO,USER_INFO,READONLY).then((({hmp:e})=>{t=e})),sha256(e)===t};
